run = "npm run build && node deployment-check.js"
entrypoint = "next.config.js"

# Ensure all environment variables are properly passed to deployment
# This maps secrets to env vars in the deployment environment
[env]
OPENAI_ASSISTANT_ID = "$OPENAI_ASSISTANT_ID"
OPENAI_API_KEY = "$OPENAI_API_KEY"
BIBLE_API_KEY = "$BIBLE_API_KEY"

# Explicitly declare which files should be included in deployment
[include]
files = [
  "**/*.js", 
  "**/*.jsx", 
  "**/*.ts", 
  "**/*.tsx", 
  "**/*.json", 
  "**/*.css",
  ".env.production",
  "public/**/*",
  ".next/**/*",
  "prisma/**/*",
  "next.config.js",
  "postcss.config.js",
  "tailwind.config.js",
  "tsconfig.json"
]

# Explicitly exclude unnecessary files from deployment
[exclude]
files = [
  "node_modules/**/*",
  "docs/**/*",
  "attached_assets/**/*",
  "**/.git/**/*"
]

[deployment]
build = ["npm", "run", "build"]
run = ["node", ".next/standalone/server.js"]
deploymentTarget = "cloudrun"